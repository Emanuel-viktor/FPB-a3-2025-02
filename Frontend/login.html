<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="shortcut icon" href="logoalert.png" type="image/x-icon">
  <link rel="stylesheet" href="estilos/style.css">
  <link rel="stylesheet" href="estilos/media-query.css">
</head>
<body>
  <main>
    <section id="login">
      <div id="imagem"></div>
      <div id="form">
        <h1>Login</h1>
        <p>Seja bem-vindo(a). Faça login ou entre anonimamente.</p>

        <form onsubmit="fazerLogin(event)" autocomplete="on">
          <div class="campo"> 
            <span class="material-icons">person</span>
            <input type="email" id="email" placeholder="E-mail" maxlength="30" required>
          </div>

          <div class="campo">
            <span class="material-icons">vpn_key</span>
            <input type="password" id="senha" placeholder="Senha" required minlength="4" maxlength="15">
          </div>

          <input type="submit" value="Entrar">

          <a href="cadastro.html" class="botao">
            Cadastro <span class="material-icons">person_add</span>
          </a>

          
          <button type="button" class="botao" onclick="entrarAnonimamente()">
            Entrar como Anônimo <span class="material-icons">visibility_off</span>
          </button>
        </form>
      </div>
    </section>
  </main>

  <script>
    
    function fazerLogin(event) {
      event.preventDefault(); 

      const email = document.querySelector("#email").value;
      const senha = document.querySelector("#senha").value;

      fetch("http://localhost:8080/users/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: email, password: senha })
      })
      .then(response => {
        if (response.ok) return response.json();
        throw new Error("Email ou senha incorretos!");
      })
      .then(user => {
        localStorage.setItem("username", user.name);
        window.location.href = "listEvents.html";
      })
      .catch(error => alert(error.message));
    }

   
    function entrarAnonimamente() {
      localStorage.setItem("username", "Anônimo");
      window.location.href = "listEvents.html";
    }
  </script>
</body>
</html>